<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.mingtai.mingtai_backend.mappers.CategoryMapper">


    <!--    Associated Queries for foreign keys-->

    <resultMap id="categoryMap" type="com.mingtai.mingtai_backend.pojos.Category">
        <id property="id" column="id" javaType="int"/>
        <result property="parent_id" column="parent_id" javaType="int"/>
        <result property="category_name" column="category_name" javaType="String"/>
        <result property="hierarchy_id" column="hierarchy_id" javaType="int"/>
        <collection property="children" ofType="com.mingtai.mingtai_backend.pojos.Category" column="{id=id, hierarchy_id=hierarchy_id}" select="getChildren">
        </collection>
    </resultMap>

    <select id="getAllCategories" resultMap="categoryMap">
        select * from category where hierarchy_id= 1
    </select>


    <insert id="addMainCategory" parameterType="com.mingtai.mingtai_backend.pojos.Category">
        INSERT INTO category (category_name, hierarchy_id) VALUES (#{category_name}, #{hierarchy_id})
    </insert>

    <insert id="addSubCategory" parameterType="com.mingtai.mingtai_backend.pojos.Category">
        INSERT INTO category (parent_id, category_name, hierarchy_id) VALUES (#{parent_id}, #{category_name}, #{hierarchy_id})
    </insert>

    <select id="getChildren" resultMap = "categoryMap">
        select * from category where parent_id=#{id}
    </select>

    <delete id="deleteCategory" parameterType="int">
        DELETE FROM category WHERE id = #{id}
    </delete>


<!--    <delete id="deleteCategory" parameterType="com.mingtai.mingtai_backend.pojos.Category">-->

<!--    </delete>-->

</mapper>